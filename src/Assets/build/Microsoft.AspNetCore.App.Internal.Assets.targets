<Project>
  <PropertyGroup>
    <ResolveStaticWebAssetsInputsDependsOn>
      $(ResolveStaticWebAssetsInputsDependsOn);
      _AddBlazorFrameworkStaticWebAssets;
    </ResolveStaticWebAssetsInputsDependsOn>
  </PropertyGroup>

  <PropertyGroup>
    <BlazorFrameworkStaticWebAssetRoot Condition="'$(BlazorFrameworkStaticWebAssetRoot)' == ''">$(MSBuildThisFileDirectory)..\_framework</BlazorFrameworkStaticWebAssetRoot>
    <BlazorFrameworkStaticWebAssetDebugRoot Condition="'$(BlazorFrameworkStaticWebAssetDebugRoot)' == ''">$(MSBuildThisFileDirectory)..\_framework\debug</BlazorFrameworkStaticWebAssetDebugRoot>

    <_UsingBlazorFrameworkStaticWebAssets Condition="'$(UsingMicrosoftNETSdkWeb)' == 'true' OR '$(UsingMicrosoftNETSdkBlazorWebAssembly)' == 'true'">true</_UsingBlazorFrameworkStaticWebAssets>
  </PropertyGroup>

  <Target Name="_AddBlazorFrameworkStaticWebAssets" Condition="'$(_UsingBlazorFrameworkStaticWebAssets)' == 'true' AND '$(OutputType)' == 'Exe'">
    <ItemGroup>
      <_FrameworkStaticWebAssetCandidate Include="$(BlazorFrameworkStaticWebAssetRoot)\*" />
      <_FrameworkStaticWebAssetCandidate
        Condition="'$(UseBlazorFrameworkDebugAssets)' == 'true'"
        Include="$(BlazorFrameworkStaticWebAssetDebugRoot)\*" />
      <_FrameworkStaticWebAssetCandidate>
        <RelativePath>_framework\%(FileName)%(Extension)</RelativePath>
        <ContentRoot>$([System.IO.Path]::GetFullPath($([System.IO.Path]::GetDirectoryName('%(Identity)'))))</ContentRoot>
      </_FrameworkStaticWebAssetCandidate>
    </ItemGroup>

    <DefineStaticWebAssets
      Condition="'@(_FrameworkStaticWebAssetCandidate->Count())' != '0'"
      CandidateAssets="@(_FrameworkStaticWebAssetCandidate)"
      SourceId="Microsoft.AspNetCore.App.Internal.Assets"
      SourceType="Discovered"
      AssetKind="All"
      FingerprintCandidates="true"
      BasePath="$(StaticWebAssetBasePath)">
      <Output TaskParameter="Assets" ItemName="_FrameworkStaticWebAsset" />
    </DefineStaticWebAssets>

    <DefineStaticWebAssetEndpoints
      Condition="'@(_FrameworkStaticWebAsset)' != ''"
      CandidateAssets="@(_FrameworkStaticWebAsset)"
      ExistingEndpoints=""
      ContentTypeMappings="@(StaticWebAssetContentTypeMapping)">
      <Output TaskParameter="Endpoints" ItemName="_FrameworkStaticAssetEndpoint" />
    </DefineStaticWebAssetEndpoints>

    <ItemGroup>
      <StaticWebAsset Include="@(_FrameworkStaticWebAsset)" />
      <StaticWebAssetEndpoint Include="@(_FrameworkStaticAssetEndpoint)" />
    </ItemGroup>
  </Target>

</Project>
