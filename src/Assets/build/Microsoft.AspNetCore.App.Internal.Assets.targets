<Project>
  <PropertyGroup>
    <ResolveStaticWebAssetsInputsDependsOn>
      $(ResolveStaticWebAssetsInputsDependsOn);
      _AddBlazorFrameworkStaticWebAssets;
    </ResolveStaticWebAssetsInputsDependsOn>
  </PropertyGroup>

  <PropertyGroup>
    <BlazorFrameworkStaticWebAssetRoot Condition="'$(BlazorFrameworkStaticWebAssetRoot)' == ''">$(MSBuildThisFileDirectory)..\_framework</BlazorFrameworkStaticWebAssetRoot>
  </PropertyGroup>

  <Target Name="_AddBlazorFrameworkStaticWebAssets" Condition="'$(OutputType)' == 'Exe'">
    <ItemGroup Condition="'$(UsingMicrosoftNETSdkWeb)' == 'true'">
      <_FrameworkStaticWebAssetCandidate Include="$(BlazorFrameworkStaticWebAssetRoot)\blazor.web.js" />
      <_FrameworkStaticWebAssetCandidate Include="$(BlazorFrameworkStaticWebAssetRoot)\blazor.server.js" />
    </ItemGroup>

    <ItemGroup Condition="'$(UsingMicrosoftNETSdkWeb)' == 'true' AND '$(UseBlazorFrameworkDebugAssets)' == 'true'">
      <_FrameworkStaticWebAssetCandidate Include="$(BlazorFrameworkStaticWebAssetRoot)\blazor.web.js.map" />
      <_FrameworkStaticWebAssetCandidate Include="$(BlazorFrameworkStaticWebAssetRoot)\blazor.server.js.map" />
    </ItemGroup>

    <PropertyGroup>
      <_IncludeAssetsInBlazorWebAssemblyProject Condition="'$(UsingMicrosoftNETSdkBlazorWebAssembly)' == 'true' AND '$(StaticWebAssetProjectMode)' != 'Default'">true</_IncludeAssetsInBlazorWebAssemblyProject>
    </PropertyGroup>

    <ItemGroup Condition="'$(_IncludeAssetsInBlazorWebAssemblyProject)' == 'true'">
      <_FrameworkStaticWebAssetCandidate Include="$(BlazorFrameworkStaticWebAssetRoot)\blazor.webassembly.js" />
    </ItemGroup>

    <ItemGroup Condition="'$(_IncludeAssetsInBlazorWebAssemblyProject)' == 'true' AND '$(UseBlazorFrameworkDebugAssets)' == 'true'">
      <_FrameworkStaticWebAssetCandidate Include="$(BlazorFrameworkStaticWebAssetRoot)\blazor.webassembly.js.map" />
    </ItemGroup>

    <ItemGroup>
      <_FrameworkStaticWebAssetCandidate>
        <RelativePath>_framework\%(FileName)%(Extension)</RelativePath>
        <ContentRoot>$([System.IO.Path]::GetFullPath($([System.IO.Path]::GetDirectoryName('%(Identity)'))))</ContentRoot>
      </_FrameworkStaticWebAssetCandidate>
    </ItemGroup>

    <DefineStaticWebAssets
      Condition="'@(_FrameworkStaticWebAssetCandidate->Count())' != '0'"
      CandidateAssets="@(_FrameworkStaticWebAssetCandidate)"
      SourceId="Microsoft.AspNetCore.App.Internal.Assets"
      SourceType="Discovered"
      AssetKind="All"
      FingerprintCandidates="true"
      BasePath="$(StaticWebAssetBasePath)">
      <Output TaskParameter="Assets" ItemName="_FrameworkStaticWebAsset" />
    </DefineStaticWebAssets>

    <DefineStaticWebAssetEndpoints
      Condition="'@(_FrameworkStaticWebAsset)' != ''"
      CandidateAssets="@(_FrameworkStaticWebAsset)"
      ExistingEndpoints=""
      ContentTypeMappings="@(StaticWebAssetContentTypeMapping)">
      <Output TaskParameter="Endpoints" ItemName="_FrameworkStaticAssetEndpoint" />
    </DefineStaticWebAssetEndpoints>

    <ItemGroup>
      <StaticWebAsset Include="@(_FrameworkStaticWebAsset)" />
      <StaticWebAssetEndpoint Include="@(_FrameworkStaticAssetEndpoint)" />
    </ItemGroup>
  </Target>

</Project>
